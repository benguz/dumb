<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Trading Platform</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background-color: black;
            color: white;
            font-family: Arial, sans-serif;
        }
        
        .controls-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
            margin: 0 auto;
            width: 95%;
            padding: 20px;
        }

        
        
        #stockSelect {
            padding: 10px;
            font-size: 16px;
            background-color: #333;
            color: white;
            border: 1px solid #555;
            border-radius: 4px;
            width: 200px;
        }
        
        #chartContainer {
            width: 95%;
            height: 80vh;
            margin: 0 auto;
            background-color: black;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px 0px;
            margin-bottom: 20px;
            position: relative;
        }

        .main-controls {
            display: flex;
            gap: 20px;
            width: 100%;
        }
        .trading-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        #currentPrice {
            font-size: 24px;
            font-weight: bold;
            min-width: 120px;
            text-align: right;
        }
        
        #stockChart {
            width: 100%;
            height: 100%;
        }


        .trading-button {
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            border: none;
            font-weight: bold;
            transition: opacity 0.2s;
        }

        .trading-button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        #buyButton {
            background-color: #28a745;
            color: white;
        }

        #sellButton {
            background-color: #dc3545;
            color: white;
        }

        #portfolio {
            font-size: 18px;
            min-width: 200px;
        }

        #cashPosition {
            font-size: 18px;
            min-width: 150px;
        }

        
        @media screen and (max-width: 768px) {
            .controls-row {
                flex-direction: column;
            }
            #chartContainer {
                width: 100%;
                height: 70vh;
            }
            .main-controls {
                flex-direction: column;
            }
            .trading-controls {
                flex-direction: column;
                text-align: left;
                width: 100%;
                align-items: flex-start;
            }
            .controls-row {
                padding: 0;
                padding-top: 10px;
            }
            #currentPrice {
                position: absolute;
                top: 2px;
                right: 2px;
                z-index: 1000;
            }
            body {
                padding: 0;
                display: flex;
                flex-direction: column-reverse;
            }
            
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script defer data-domain="dumbtrading.com" src="https://plausible.io/js/script.js"></script>
</head>
<body>
    <div class="controls-row">
        <div  class="main-controls" >
            <div style="display: flex; gap: 5px; width: 100%;">   
            <select id="stockSelect">
                <option value="AAPL">Apple (AAPL)</option>
                <option value="GOOGL">Google (GOOGL)</option>
                <option value="MSFT">Microsoft (MSFT)</option>
                <option value="AMZN">Amazon (AMZN)</option>
                <option value="BITCOIN">Bitcoin (BTC)</option>
            </select>
            <div style="display: flex; direction: row; gap: 5px; width: 100%;">
                <button id="buyButton" class="trading-button">Buy</button>
                <button id="sellButton" class="trading-button">Sell</button>
        </div>
            </div>
            
            <div class="trading-controls">
                <div id="portfolio">
                    Shares: 0 | P/L: $0.00
                </div>
                <div id="cashPosition">
                    Cash: $1,000.00
                </div>
            </div>
        </div>
        <div id="currentPrice"></div>
    </div>

    <div id="chartContainer">
        <canvas id="stockChart"></canvas>
    </div>

    <script>
        // Generate random starting prices between 100 and 1000
        const APPLPRICE = Math.random() * 100 + 100;
        const GOOGLPRICE = Math.random() * 500 + 100;
        const TSLAPRICE = Math.random() * 350 + 100;
        const AMZNPRICE = Math.random() * 250 + 100;
        const BITCOINPRICE = Math.random() * 10000 + 10000;
        const stockData = {
            AAPL: {currentPrice: APPLPRICE, history: [], startPrice: APPLPRICE, shares: 0, totalCost: 0},
            GOOGL: {currentPrice: GOOGLPRICE, history: [], startPrice: GOOGLPRICE, shares: 0, totalCost: 0},
            TSLA: {currentPrice: TSLAPRICE, history: [], startPrice: TSLAPRICE, shares: 0, totalCost: 0},
            AMZN: {currentPrice: AMZNPRICE, history: [], startPrice: AMZNPRICE, shares: 0, totalCost: 0},
            BITCOIN: {currentPrice: BITCOINPRICE, history: [], startPrice: BITCOINPRICE, shares: 0, totalCost: 0}
        };
        function createGradient(ctx, isPositive) {
            const gradient = ctx.createLinearGradient(0, 0, 0, 400);
            if (isPositive) {
                gradient.addColorStop(0, 'rgba(0, 255, 0, 0.7)');
                gradient.addColorStop(1, 'rgba(0, 255, 0, 0.0)');
            } else {
                gradient.addColorStop(0, 'rgba(255, 0, 0, 0.7)');
                gradient.addColorStop(1, 'rgba(255, 0, 0, 0.0)');
            }
            return gradient;
        }


        let cashBalance = 1000; // Starting cash position

        // Initialize history arrays
        Object.keys(stockData).forEach(stock => {
            stockData[stock].startPrice = stockData[stock].currentPrice;
            stockData[stock].history = Array(50).fill(stockData[stock].currentPrice );
        });

        let chart;
        let currentStock = 'AAPL';

        function updateButtonStates() {
            const buyButton = document.getElementById('buyButton');
            const sellButton = document.getElementById('sellButton');
            const data = stockData[currentStock];
            
            buyButton.disabled = cashBalance < data.currentPrice;
            sellButton.disabled = data.shares <= 0;
        }

        function updateCashPosition() {
            const cashDisplay = document.getElementById('cashPosition');
            cashDisplay.textContent = `Cash: $${cashBalance.toFixed(2)}`;
            // cashDisplay.style.color = cashBalance >= 1000 ? '#00ff00' : '#ffffff';
            updateButtonStates();
        }

        function updatePortfolio() {
            const data = stockData[currentStock];
            const shares = data.shares;
            const currentValue = shares * data.currentPrice;
            const profitLoss = currentValue - data.totalCost;
            const portfolio = document.getElementById('portfolio');
            portfolio.textContent = `Shares: ${shares} | P/L: ${profitLoss >= 0 ? '+' : ''}$${profitLoss.toFixed(2)}`;
            portfolio.style.color = profitLoss >= 0 ? '#00ff00' : '#ff0000';
            updateButtonStates();
        }

        function updatePrice(stock) {
            // Random price movement between -2% and +2%
            const priceChangeFactor = stock === 'BITCOIN' ? 0.20 : 0.04;
            const changePercent = (Math.random() - 0.5) * priceChangeFactor;
            const meanReversionFactor = 0.1; // Adjust this factor to control mean reversion strength
            const meanPrice = stockData[stock].startPrice;
            const newPrice = stockData[stock].currentPrice * (1 + changePercent) + meanReversionFactor * (meanPrice - stockData[stock].currentPrice);
            stockData[stock].currentPrice = newPrice;
            
            stockData[stock].history.push(newPrice);
            if (stockData[stock].history.length > 50) {
                stockData[stock].history.shift();
            }

            // Update price display
            const priceDisplay = document.getElementById('currentPrice');
            const isPositive = newPrice >= stockData[stock].startPrice;
            priceDisplay.style.color = isPositive ? '#00ff00' : '#ff0000';
            priceDisplay.textContent = `$${newPrice.toFixed(2)}`;
            
            updatePortfolio();
        }

        function updateChart(stock) {
            const ctx = document.getElementById('stockChart').getContext('2d');
            const data = stockData[stock];
            const isPositive = data.history[data.history.length - 1] >= data.history[0];

            if (!chart) {
                chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: Array(data.history.length).fill(''),
                        datasets: [{
                            label: stock,
                            data: data.history,
                            borderColor: isPositive ? '#00ff00' : '#ff0000',
                            borderWidth: 2,
                            fill: isPositive ? true : 'origin',
                            backgroundColor: createGradient(ctx, isPositive),
                            tension: 0.4,
                            pointRadius: 0 
                        },
                        {
                            label: 'Starting Price',
                            data: Array(data.history.length).fill(data.startPrice),
                            borderColor: '#666',
                            borderWidth: 1,
                            borderDash: [5, 5],
                            fill: false,
                            tension: 0,
                            pointRadius: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: false,
                                grid: {
                                    color: '#333'
                                },
                                ticks: {
                                    display: false
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                },
                                ticks: {
                                    display: false
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        animation: {
                            duration: 0,
                        }
                    }
                });
            } else {
                chart.data.datasets[0].data = data.history;
                chart.data.datasets[0].borderColor = isPositive ? '#00ff00' : '#ff0000';
                chart.data.datasets[0].fill = isPositive ? true : 'origin';
                chart.data.datasets[0].backgroundColor = createGradient(ctx, isPositive);
                chart.data.datasets[1].data = Array(data.history.length).fill(data.startPrice);
                const recentHistory = data.history.slice(-50);
                chart.options.scales.y.min = Math.min(...recentHistory, data.startPrice);
                chart.options.scales.y.max = Math.max(...recentHistory, data.startPrice);
                chart.update();
            }
        }

        document.getElementById('stockSelect').addEventListener('change', (e) => {
            currentStock = e.target.value;
            if (chart) {
                chart.destroy();
                chart = null;
            }
            updateChart(currentStock);
            updatePortfolio();
        });

        document.getElementById('buyButton').addEventListener('click', () => {
            const data = stockData[currentStock];
            if (cashBalance >= data.currentPrice) {
                data.shares++;
                data.totalCost += data.currentPrice;
                cashBalance -= data.currentPrice;
                updatePortfolio();
                updateCashPosition();
            }
        });

        document.getElementById('sellButton').addEventListener('click', () => {
            const data = stockData[currentStock];
            if (data.shares > 0) {
                data.shares--;
                cashBalance += data.currentPrice;
                data.totalCost = (data.shares * data.totalCost) / (data.shares + 1); // Adjust cost basis
                updatePortfolio();
                updateCashPosition();
            }
        });

        // Update prices and chart every 100ms for smoother animation
        setInterval(() => {
            updatePrice(currentStock);
            updateChart(currentStock);
        }, 100);

        // Initial setup
        updateChart('AAPL');
        updateCashPosition();
        updateButtonStates();
    </script>
</body>
</html>
